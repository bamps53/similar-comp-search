**類似コンペ検索サイトの設計ドキュメント**

---

**1. はじめに**

本ドキュメントは、ユーザーがKaggleの過去のコンペティションやソリューションを様々な観点から検索できるウェブアプリケーションの設計について説明します。本アプリケーションは、指定したコンペティションに類似したコンペやソリューションを見つけることで、ユーザーの学習や参加を支援することを目的としています。

**2. 目的と要件**

- **ユーザ機能:**
  - ユーザーが入力した情報に基づいて過去のコンペとソリューションを検索できる。
  - コンペの検索とソリューションの検索を切り替えられる。
  - 指定したコンペの類似コンペを検索できる。
  - データの種類、タスク、ドメインなどを指定して検索できる。
  - 類似性の観点（名前、データ、ドメインなど）をプリセットから選択できる。

- **技術的要件:**
  - **フロントエンド:**
    - Vite、React、TypeScript、Chakra UI、React Routerを使用。
    - 可能な限りグローバル状態管理を避ける。必要ならZustandを使用。
    - ダークモードを搭載。
    - 美しく、快適なユーザー体験を提供する。

  - **バックエンド:**
    - PythonとFastAPIを使用。
    - 軽量でシンプルなデータベースを使用（SQLiteなど）。
    - Pythonの型ヒントを徹底して使用。

  - **データ処理:**
    - コンペのデータはCSVファイルで提供され、カラムは随時増加。
    - データベースへのマイグレーションが可能であること。
    - Meta Kaggleのデータセットを元に、独自のタグ付けやドメイン情報を追加。

  - **テスト:**
    - テスト駆動開発（TDD）を採用。
    - フロントエンドはJest、バックエンドはPytestを使用。
    - 静的解析を通じてバグを事前に検知。

  - **デプロイ:**
    - Docker Composeを使用し、`docker-compose up`でバックエンドとフロントエンドを起動。
    - 無料のホスティングソリューションを目指す。
    - デプロイと更新が容易であること。

  - **その他の要件:**
    - 設計ドキュメントをプロジェクト内に含め、常にメンテナンスする。
    - 新しすぎるライブラリやAPIの変化が大きいライブラリの使用を避ける。
    - TypeScriptとPythonの型ヒントを徹底的に使用。

**3. アーキテクチャ概要**

- **フロントエンド:**
  - ReactとTypeScriptを用いたシングルページアプリケーション（SPA）。
  - UIコンポーネントはChakra UIでスタイリング。
  - React Routerによるクライアントサイドルーティング。
  - ダークモードのテーマ切り替え機能。

- **バックエンド:**
  - FastAPIによるRESTful API。
  - 軽量なデータベース（SQLite）を使用。
  - 類似度計算はバックエンドで実行。

- **データストレージ:**
  - データベースにコンペとソリューションのデータを保存。
  - CSVからのデータインポートと更新をサポート。
  - 検索性能を最適化するためのインデックスを設定。

- **類似度計算:**
  - 複数の類似度計算手法を実装（TF-IDF、LLM埋め込みなど）。
  - ユーザーがプリセットから類似性の観点を選択可能。
  - 必要に応じて類似度のキャッシュを実装。

- **デプロイ:**
  - Dockerでアプリケーションをコンテナ化。
  - Docker Composeでフロントエンドとバックエンドをオーケストレーション。

**4. 詳細設計**

---

**4.1 フロントエンド**

- **使用技術:**
  - **React**: UIコンポーネントの構築。
  - **TypeScript**: 型安全性と静的解析。
  - **Vite**: 高速な開発とビルドツール。
  - **Chakra UI**: アクセシブルでテーマ可能なUIコンポーネント。
  - **React Router**: クライアントサイドルーティング。
  - **状態管理**: Reactの組み込み機能を使用。必要ならZustandを導入。

- **UIコンポーネント:**
  - **検索バー**: ユーザーの検索クエリ入力。
  - **切り替えスイッチ**: コンペ検索とソリューション検索の切り替え。
  - **フィルター**: データの種類、タスク、ドメインの指定。
  - **類似性オプション**: プリセットから類似性の観点を選択。
  - **結果表示**: 検索結果をリストやグリッドで表示。ページネーションや無限スクロールを実装。
  - **ダークモードトグル**: テーマの切り替え。

- **ルーティング:**
  - **ホームページ**: 検索機能を含むイントロダクション。
  - **検索結果ページ**: コンペまたはソリューションの検索結果を表示。
  - **コンペ詳細ページ**: 特定のコンペの詳細情報。
  - **ソリューション詳細ページ**: 特定のソリューションの詳細情報。

- **状態管理:**
  - Reactのフック（`useState`, `useEffect`, `useContext`）を活用。
  - グローバル状態管理は必要時のみ導入。

- **TypeScriptの実践:**
  - すべてのコンポーネントとデータ構造に対してインターフェースと型を定義。
  - 厳密な型付けで開発中のエラーを防止。

- **テスト:**
  - **Jest**と**React Testing Library**を使用したユニットテストと統合テスト。
  - ユーザーインタラクションと状態変化に焦点を当ててテストを作成。

---

**4.2 バックエンド**

- **使用技術:**
  - **FastAPI**: RESTful APIの構築。
  - **Python 3.x**: 型ヒントに対応。
  - **データベース**: **SQLite**を使用。
  - **データ処理**: **pandas**、**NumPy**。
  - **類似度計算**:
    - **scikit-learn**: TF-IDFなどの従来手法。
    - **Sentence Transformers**や**OpenAI API**: LLMベースの埋め込み（無料ホスティングに適合する範囲で）。

- **APIエンドポイント:**
  - **コンペ検索**: `GET /api/competitions/search`
    - クエリパラメータ：キーワード、フィルター、類似性の観点。
  - **ソリューション検索**: `GET /api/solutions/search`
  - **コンペ詳細取得**: `GET /api/competitions/{id}`
  - **ソリューション詳細取得**: `GET /api/solutions/{id}`
  - **類似コンペ取得**: `GET /api/competitions/{id}/similar`
    - パラメータ：類似性の観点。

- **データモデル:**
  - **Competitionモデル**: slug、title、subtitle、deadline_date、tags、domainなどのフィールド。
  - **Solutionモデル**: competition_id、リンク、リポジトリリンク、説明など。
  - **データベーススキーマ**: 効率的なクエリのために適切なインデックスを設定。

- **データ処理:**
  - **CSVインポート**: CSVファイルからデータをインポート・更新するスクリプトを作成。
  - **マイグレーションツール**: カラムの変更時に**Alembic**でデータベースをマイグレーション。
  - **データ検証**: インポート時にデータの一貫性をチェック。

- **類似度計算:**
  - **従来手法**: テキストフィールドのTF-IDFベクトル化。
  - **埋め込み手法**: 事前学習モデルで埋め込みを取得。
    - 軽量なモデルを使用し、GPU不要で動作するように。
  - **ハイブリッド手法**: 複数の類似度指標を組み合わせてスコアを計算。

- **型ヒントと静的解析:**
  - Pythonの型ヒントを全コードベースで使用。
  - **mypy**で静的型チェックを実施。

- **テスト:**
  - **Pytest**を使用したユニットテストと統合テスト。
  - APIエンドポイント、データ処理関数、類似度計算のテストを作成。

---

**4.3 データストレージ**

- **データベース選定:**
  - **SQLite**を採用し、シンプルでセットアップが容易。
  - 将来的なスケーラビリティに応じて、他のデータベースへの移行も検討。

- **スキーマ設計:**
  - **Competitionsテーブル**:
    - `id`, `slug`, `title`, `subtitle`, `deadline_date`, `tags`, `domain`, `description`など。
  - **Solutionsテーブル**:
    - `id`, `competition_id`, `link`, `repository_link`, `description`など。
  - **インデックス**:
    - `slug`, `title`, `tags`にインデックスを設定。
    - フルテキスト検索が可能なら設定。

- **データマイグレーション:**
  - **Alembic**を使用してスキーマ変更とデータベースマイグレーションを管理。
  - CSVファイルに新しいカラムが追加された際にマイグレーションスクリプトを作成。

- **データインポートプロセス:**
  - CSVファイルを読み込み、データを検証・クレンジング。
  - 新規レコードと既存レコードを適切にデータベースに更新。

---

**4.4 類似度計算**

- **類似性の観点オプション:**
  - **名前の類似性**: コンペタイトルに基づく。
  - **データの類似性**: データタイプや特徴に基づく。
  - **ドメインの類似性**: コンペのドメイン（例: コンピュータビジョン、NLP）。

- **実装詳細:**
  - **テキストベースの類似度**:
    - TF-IDFによるテキストフィールドのベクトル化。
    - コサイン類似度の計算。
  - **埋め込みベースの類似度**:
    - 事前学習モデルで埋め込みを取得。
    - **Sentence Transformers**などのモデルを使用。
  - **ハイブリッドアプローチ**:
    - 複数の類似度指標を組み合わせ、重み付けスコアを計算。

- **ユーザー選択:**
  - プリセットのオプションから類似性の観点を選択可能。
  - UIでのドロップダウンメニューなどを実装。

- **パフォーマンス最適化:**
  - 埋め込みや類似度スコアを事前計算し、データベースに保存。
  - 数値計算には効率的なライブラリを使用。
  - スケーラビリティのために近似最近傍探索アルゴリズムを検討。

---

**4.5 API**

- **ドキュメント化:**
  - FastAPIの自動ドキュメント生成（OpenAPI/Swagger UI）を活用。
  - すべてのエンドポイントを詳細にドキュメント化し、リクエストとレスポンスの例を提供。

- **セキュリティ:**
  - 初期段階では読み取り専用の機能が主であるため、セキュリティ要件は低い。
  - 必要に応じてレートリミットを実装し、不正利用を防止。

- **エラーハンドリング:**
  - 適切なHTTPステータスコードを返す。
  - クライアント側での処理を容易にするため、意味のあるエラーメッセージを提供。

---

**5. テスト**

- **フロントエンドテスト:**
  - **ユニットテスト**: 個々のコンポーネントを単体でテスト。
  - **統合テスト**: コンポーネント間の相互作用やバックエンドAPIとの連携をテスト（APIレスポンスはモック化）。
  - **エンドツーエンドテスト**: **Cypress**などを使用してアプリケーション全体のフローをテスト。

- **バックエンドテスト:**
  - **ユニットテスト**: 個々の関数、特にデータ処理や類似度計算をテスト。
  - **統合テスト**: テスト用データベースを使用してAPIエンドポイントをテスト。
  - **テストカバレッジ**: エッジケースを含め、高いテストカバレッジを目指す。

- **継続的インテグレーション（CI）:**
  - **GitHub Actions**などを使用し、コミットやプルリクエストごとにテストを実行。
  - CIパイプラインに静的解析ツールを組み込む。

- **静的解析:**
  - **フロントエンド**: TypeScriptのコンパイラチェックを活用。
  - **バックエンド**: `mypy`でPythonの型チェックを実施。

---

**6. デプロイ**

- **Docker化:**
  - フロントエンドとバックエンドのそれぞれにDockerfileを作成。
  - マルチステージビルドでイメージサイズを最適化。

- **Docker Compose:**
  - `docker-compose.yml`を作成し、サービス、ネットワーク、ボリュームを定義。
  - `docker-compose up`で全サービスが起動することを確認。

- **ホスティング:**
  - **フロントエンド**: **GitHub Pages**や**Netlify**でのホスティングを検討（Docker対応可の場合）。
  - **バックエンド**: 無料ティアを提供する**Heroku**、**Railway.app**、**Render**などを検討。
  - **データベース**: SQLiteはファイルベースなので、ホスティング環境でのファイル永続化を確認。

- **環境変数:**
  - APIキーやデータベースURLなどの設定に環境変数を使用。
  - 機密情報は安全に管理し、ハードコーディングを避ける。

---

**7. 将来の展望とスケーラビリティ**

- **スケーラビリティの考慮:**
  - 初期のユーザー数は少ない想定だが、システムが拡張可能であるよう設計。
  - 必要に応じて、より堅牢なデータベース（PostgreSQLなど）への移行を検討。
  - 頻繁にアクセスされるデータに対してキャッシュ戦略を実装。

- **機能拡張:**
  - ユーザーアカウントやパーソナライゼーション機能の追加。
  - お気に入りのコンペやソリューションを保存できるように。
  - より細かなフィルターを備えた高度な検索機能の実装。

- **パフォーマンス最適化:**
  - アプリケーションのパフォーマンスを監視し、必要に応じて最適化。
  - プロファイリングツールを使用してボトルネックを特定。

- **アクセシビリティ:**
  - 障害を持つユーザーにも利用可能なアプリケーションを目指す。
  - ウェブアクセシビリティのベストプラクティス（WCAGガイドライン）に従う。

---

**8. 結論**

本設計ドキュメントは、指定された要件を満たす類似コンペ検索サイトの開発計画をまとめたものです。TDD、静的型付け、モジュール設計などのソフトウェア開発のベストプラクティスに従うことで、堅牢でユーザーフレンドリーなアプリケーションの提供を目指します。設計は将来的な拡張性とスケーラビリティを考慮しつつ、ユーザーに即時の価値を提供することに焦点を当てています。

**9. 付録**

- **付録A: 技術スタック**

  - **フロントエンド:**
    - React
    - TypeScript
    - Vite
    - Chakra UI
    - React Router
    - Jest
    - React Testing Library

  - **バックエンド:**
    - FastAPI
    - Python 3.x
    - SQLite
    - Pandas、NumPy
    - Scikit-learn
    - Pytest
    - Mypy

  - **デプロイ:**
    - Docker
    - Docker Compose

- **付録B: 外部ライブラリとツール**

  - **データ処理:**
    - Alembic（データベースマイグレーション）
    - Sentence Transformers（埋め込み使用時）

  - **テストとCI/CD:**
    - GitHub Actions（継続的インテグレーション）
    - Cypress（エンドツーエンドテスト、オプション）
